(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{3:(e,t,r)=>{"use strict";r.d(t,{default:()=>R});var a=r(5155),s=r(221),c=r(2177),l=r(2115),n=r(285),d=r(7759),o=r(2523),i=r(6695),u=r(7481),h=r(8370),x=r(4477);let m=(0,x.createServerReference)("40b694c3fbe870c23449871686068c88cea982f095",x.callServer,void 0,x.findSourceMapURL,"fetchProductByBarcodeAction"),p=(0,x.createServerReference)("402c124c2d05279790b9a3330d4293d2e299611f9b",x.callServer,void 0,x.findSourceMapURL,"sellProductAction");var f=r(1841),v=r(157);let j=(0,v.A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);var g=r(5422),b=r(172);let y=(0,v.A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),w=(0,v.A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var N=r(2085),k=r(9434);let S=(0,N.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),A=l.forwardRef((e,t)=>{let{className:r,variant:s,...c}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,k.cn)(S({variant:s}),r),...c})});A.displayName="Alert";let C=l.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h5",{ref:t,className:(0,k.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})});C.displayName="AlertTitle";let P=l.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,k.cn)("text-sm [&_p]:leading-relaxed",r),...s})});function R(){let{toast:e}=(0,u.dj)(),[t,r]=(0,l.useTransition)(),[x,v]=(0,l.useState)(!1),[N,k]=(0,l.useState)(null),[S,R]=(0,l.useState)(null),[M,E]=(0,l.useState)(!1),B=(0,c.mN)({resolver:(0,s.u)(h.b),defaultValues:{barcode:"",quantity:1}}),V=B.watch("barcode");return(0,l.useEffect)(()=>{k(null),R(null),V&&V.length>=5&&(async()=>{E(!0);let e=await m(V);e?(k(e),R(null)):(k(null),R("Product with this barcode not found.")),E(!1)})()},[V]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Zp,{className:"w-full max-w-xl mx-auto shadow-xl rounded-lg",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"text-3xl font-headline text-primary flex items-center gap-2",children:[(0,a.jsx)(j,{className:"h-8 w-8"})," Sell Product"]}),(0,a.jsx)(i.BT,{children:"Scan or enter product barcode, then specify quantity to sell."})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)(d.lV,{...B,children:(0,a.jsxs)("form",{onSubmit:B.handleSubmit(function(t){if(!N)return void e({title:"Error",description:"No product selected. Please scan or enter a valid barcode.",variant:"destructive"});r(async()=>{let r=await p(t);r.success&&r.product?(e({title:"Success!",description:"".concat(r.message," New stock for ").concat(r.product.name,": ").concat(r.product.currentStock)}),k(r.product),B.reset({barcode:t.barcode,quantity:1})):(e({title:"Error",description:r.message||"Could not sell product.",variant:"destructive"}),r.errors&&r.errors.forEach(e=>{B.setError(e.path[0],{message:e.message})}))})}),className:"space-y-8",children:[(0,a.jsx)(d.zB,{control:B.control,name:"barcode",render:e=>{let{field:t}=e;return(0,a.jsxs)(d.eI,{children:[(0,a.jsx)(d.lR,{children:"Product Barcode"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.MJ,{children:(0,a.jsx)(o.p,{placeholder:"Scan or enter barcode",...t})}),(0,a.jsxs)(n.$,{type:"button",variant:"outline",onClick:()=>v(!0),className:"shrink-0",children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Scan"]})]}),M&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1 pt-1",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 animate-spin"})," Checking barcode..."]}),(0,a.jsx)(d.C5,{}),S&&!M&&(0,a.jsx)("p",{className:"text-sm font-medium text-destructive pt-1",children:S})]})}}),N&&(0,a.jsxs)(A,{className:"bg-accent/20 border-accent/50 shadow-sm rounded-lg",children:[(0,a.jsx)(y,{className:"h-5 w-5 text-accent"}),(0,a.jsx)(C,{className:"font-headline text-accent",children:N.name}),(0,a.jsxs)(P,{children:["Current Stock: ",N.currentStock," | MRP: $",N.mrp.toFixed(2)," | Cost Code: ",N.costPriceCode]})]}),(0,a.jsx)(d.zB,{control:B.control,name:"quantity",render:e=>{let{field:t}=e;return(0,a.jsxs)(d.eI,{children:[(0,a.jsx)(d.lR,{children:"Quantity"}),(0,a.jsx)(d.MJ,{children:(0,a.jsx)(o.p,{type:"number",step:"1",placeholder:"e.g., 1",...t})}),(0,a.jsx)(d.C5,{})]})}}),(0,a.jsxs)(n.$,{type:"submit",disabled:t||!N||M,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground rounded-md shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[t?(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Sell Product"]})]})})}),N&&N.currentStock<=N.lowInventoryFactor&&(0,a.jsx)(i.wL,{children:(0,a.jsxs)(A,{variant:"destructive",className:"w-full text-sm",children:[(0,a.jsx)(w,{className:"h-4 w-4"}),(0,a.jsx)(C,{children:"Low Stock Warning!"}),(0,a.jsx)(P,{children:"This product will be critically low or out of stock after this sale."})]})})]}),(0,a.jsx)(f.A,{open:x,onOpenChange:v,onScanComplete:e=>{B.setValue("barcode",e,{shouldValidate:!0})}})]})}P.displayName="AlertDescription"},1614:(e,t,r)=>{Promise.resolve().then(r.bind(r,3))}},e=>{var t=t=>e(e.s=t);e.O(0,[802,44,274,441,684,358],()=>t(1614)),_N_E=e.O()}]);